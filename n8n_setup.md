# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ n8n Workflow –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∂–∞–ª–æ–±

## –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∂–∞–ª–æ–±—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫–∞–∂–¥—ã–π —á–∞—Å:
- –î–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∂–∞–ª–æ–±: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∂–∞–ª–æ–±—É
- –î–ª—è –∂–∞–ª–æ–± –æ–± –æ–ø–ª–∞—Ç–µ: –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ Google Sheets –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∂–∞–ª–æ–±—É

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ n8n

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ npm
npm install n8n -g

# –ò–ª–∏ —á–µ—Ä–µ–∑ Docker
docker run -it --rm \
  --name n8n \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ [@BotFather](https://t.me/botfather):
   ```
   /newbot
   ComplaintBot
   complaint_processing_bot
   ```

2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è n8n:
   ```
   TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
   ```

3. –ü–æ–ª—É—á–∏—Ç–µ chat_id:
   - –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É –∏–ª–∏ –Ω–∞—á–Ω–∏—Ç–µ —Å –Ω–∏–º –¥–∏–∞–ª–æ–≥
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
   - –ù–∞–π–¥–∏—Ç–µ `chat.id` –≤ –æ—Ç–≤–µ—Ç–µ

4. –î–æ–±–∞–≤—å—Ç–µ chat_id –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```
   TELEGRAM_CHAT_ID=123456789
   ```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Sheets

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Google Cloud Console](https://console.cloud.google.com/)

2. –í–∫–ª—é—á–∏—Ç–µ Google Sheets API:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "APIs & Services" > "Library"
   - –ù–∞–π–¥–∏—Ç–µ "Google Sheets API" –∏ –≤–∫–ª—é—á–∏—Ç–µ

3. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "APIs & Services" > "Credentials"
   - –ù–∞–∂–º–∏—Ç–µ "Create Credentials" > "Service Account"
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç

4. –°–∫–∞—á–∞–π—Ç–µ JSON –∫–ª—é—á:
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Keys"
   - –ù–∞–∂–º–∏—Ç–µ "Add Key" > "Create new key" > "JSON"
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª

5. –°–æ–∑–¥–∞–π—Ç–µ Google Sheets:
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –∏–∑ URL (–º–µ–∂–¥—É /d/ –∏ /edit)
   - –î–æ–±–∞–≤—å—Ç–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```
   GOOGLE_SHEETS_SPREADSHEET_ID=1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms
   ```

## –ò–º–ø–æ—Ä—Ç Workflow

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n: http://localhost:5678

2. –ù–∞–∂–º–∏—Ç–µ "Import from file"

3. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª `n8n_workflow.json`

4. –ù–∞–∂–º–∏—Ç–µ "Import"

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ API

```bash
curl -X POST "http://localhost:5678/api/v1/workflows" \
  -H "Content-Type: application/json" \
  -d @n8n_workflow.json
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–∑–ª–æ–≤

### 1. Schedule Trigger

- **–¢–∏–ø**: Schedule Trigger
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª**: –ö–∞–∂–¥—ã–π —á–∞—Å
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 2. Get Recent Complaints

- **–¢–∏–ø**: HTTP Request
- **–ú–µ—Ç–æ–¥**: GET
- **URL**: `http://localhost:8000/complaints/recent/`
- **Query Parameters**:
  - `hours`: `1`
  - `status`: `open`

### 3. Category Switch

- **–¢–∏–ø**: Switch
- **–ü—Ä–∞–≤–∏–ª–∞**:
  - **–ü—Ä–∞–≤–∏–ª–æ 1**: `{{ $json.category }}` equals `—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è`
  - **–ü—Ä–∞–≤–∏–ª–æ 2**: `{{ $json.category }}` equals `–æ–ø–ª–∞—Ç–∞`
  - **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –î—Ä—É–≥–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### 4. Telegram Notification

- **–¢–∏–ø**: Telegram
- **–û–ø–µ—Ä–∞—Ü–∏—è**: Send Message
- **Chat ID**: `{{ $env.TELEGRAM_CHAT_ID }}`
- **–¢–µ–∫—Å—Ç**: 
```
üö® –ù–æ–≤–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∂–∞–ª–æ–±–∞!

ID: {{ $json.id }}
–¢–µ–∫—Å—Ç: {{ $json.text }}
–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: {{ $json.sentiment }}
–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ $json.category }}

–í—Ä–µ–º—è: {{ $now }}
```

### 5. Add to Google Sheets

- **–¢–∏–ø**: Google Sheets
- **–û–ø–µ—Ä–∞—Ü–∏—è**: Append
- **Document ID**: `{{ $env.GOOGLE_SHEETS_SPREADSHEET_ID }}`
- **Sheet Name**: `Complaints`
- **Columns**:
  - –î–∞—Ç–∞: `{{ $now }}`
  - ID: `{{ $json.id }}`
  - –¢–µ–∫—Å—Ç: `{{ $json.text }}`
  - –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å: `{{ $json.sentiment }}`
  - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: `{{ $json.category }}`
  - –°—Ç–∞—Ç—É—Å: `open`

### 6. Update Status (Technical)

- **–¢–∏–ø**: HTTP Request
- **–ú–µ—Ç–æ–¥**: PUT
- **URL**: `http://localhost:8000/complaints/{{ $json.id }}/`
- **Headers**: `Content-Type: application/json`
- **Body**: `{"status": "closed"}`

### 7. Update Status (Payment)

- **–¢–∏–ø**: HTTP Request
- **–ú–µ—Ç–æ–¥**: PUT
- **URL**: `http://localhost:8000/complaints/{{ $json.id }}/`
- **Headers**: `Content-Type: application/json`
- **Body**: `{"status": "closed"}`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í n8n –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings > Variables –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```
TELEGRAM_BOT_TOKEN=your_bot_token_here
TELEGRAM_CHAT_ID=your_chat_id_here
GOOGLE_SHEETS_SPREADSHEET_ID=your_spreadsheet_id_here
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### Telegram
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings > Credentials
2. –ù–∞–∂–º–∏—Ç–µ "Add Credential"
3. –í—ã–±–µ—Ä–∏—Ç–µ "Telegram"
4. –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

### Google Sheets
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings > Credentials
2. –ù–∞–∂–º–∏—Ç–µ "Add Credential"
3. –í—ã–±–µ—Ä–∏—Ç–µ "Google Sheets"
4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Ñ–∞–π–ª —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Workflow

### 1. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
1. –û—Ç–∫—Ä–æ–π—Ç–µ workflow –≤ n8n
2. –ù–∞–∂–º–∏—Ç–µ "Execute Workflow"
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –∂–∞–ª–æ–±—É
curl -X POST "http://localhost:8000/complaints/" \
  -H "Content-Type: application/json" \
  -d '{"text": "–°–∞–π—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ—à–∏–±–∫–∞ 500"}'

# –°–æ–∑–¥–∞–π—Ç–µ –∂–∞–ª–æ–±—É –æ–± –æ–ø–ª–∞—Ç–µ
curl -X POST "http://localhost:8000/complaints/" \
  -H "Content-Type: application/json" \
  -d '{"text": "–°–ø–∏—Å–∞–ª–∏ –¥–µ–Ω—å–≥–∏ –¥–≤–∞–∂–¥—ã"}'
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Telegram –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Google Sheets –Ω–∞ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∂–∞–ª–æ–± –≤ API

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
1. –í n8n –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "Executions"
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ workflow
3. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
1. –î–æ–±–∞–≤—å—Ç–µ —É–∑–µ–ª "Error Trigger" –≤ workflow
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫ Telegram –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç)
- –î–æ–±–∞–≤—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –∂–∞–ª–æ–±
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ batch –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∂–∞–ª–æ–±

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- –î–æ–±–∞–≤—å—Ç–µ retry –ª–æ–≥–∏–∫—É –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ fallback –¥–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –î–æ–±–∞–≤—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è workflow

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ chat_id
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —á–∞—Ç

2. **Google Sheets –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ JSON –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –≤–∫–ª—é—á–µ–Ω
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ

3. **API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ —É–∑–ª–∞—Ö HTTP Request
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–æ–±–∞–≤—å—Ç–µ —É–∑–ª—ã "Set" –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
```json
{
  "timestamp": "{{ $now }}",
  "complaint_id": "{{ $json.id }}",
  "action": "processed"
}
```

## –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ "Category Switch"
2. –°–æ–∑–¥–∞–π—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —É–∑–ª—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- Slack —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- Jira —Ç–∏–∫–µ—Ç—ã
- CRM —Å–∏—Å—Ç–µ–º—ã

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- –î–æ–±–∞–≤—å—Ç–µ —É–∑–ª—ã –¥–ª—è —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫ 